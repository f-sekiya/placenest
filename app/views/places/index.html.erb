<% content_for :left do %>

  <!-- 簡易登録（未分類へ追加） -->
  <div class="left-quick">
    <h3 class="left-quick__title">Item簡易登録</h3>
    <p class="left-quick__hint">追加先：未分類</p>

    <%= form_with url: quick_create_items_path,
                  scope: :item,
                  method: :post,
                  local: true,
                  class: "left-quick__row" do |f| %>

      <%= f.text_field :name, placeholder: "名前（必須）", required: true, class: "input" %>
      <%= f.number_field :quantity, min: 0, value: 1, class: "input input--small" %>
      <%= f.submit "追加", class: "btn btn--primary" %>
    <% end %>
  </div>

  <!-- Placeツリー -->
  <div class="left-head">
    <h2 class="left-head__title">Place</h2>

    <div id="place_new">
      <%= render "places/place_new",
                 place: @new_place,
                 parent_id: @current_place&.id,
                 open: false %>
    </div>
  </div>

  <div class="left-tree">
    <%= turbo_frame_tag "place_tree" do %>
      <%= render "places/place_tree",
                 place_tree: @place_tree,
                 current_place: @current_place %>
    <% end %>
  </div>

<% end %>


<!-- 中央ヘッダー -->
<div class="middle-head">
  <div class="middle-head__top">
    <h2 class="middle-head__title">Item一覧</h2>
    <div class="middle-head__actions">
      <%= link_to "Item登録", new_item_path, class: "btn btn--ghost" %>
    </div>
  </div>

  <div class="middle-head__context">
    <span class="context-label">現在地</span>
    <span class="context-place"><%= @current_place.name %></span>
    <span class="context-meta">（Items: <%= @items.size %>）</span>
  </div>

  <div class="middle-head__breadcrumb">
    <%= @current_place.path_string %>
  </div>

  <% if @current_place.description.present? %>
    <p class="place-memo"><%= simple_format(@current_place.description) %></p>
  <% end %>
</div>

<!-- 検索（選択中Place内） -->
<%= form_with url: root_path, method: :get, local: true, class: "search-form" do |f| %>
  <%= hidden_field_tag :place_id, @current_place.id %>
  <%= f.label :q, "検索（選択中Place内）", class: "search-form__label" %>
  <div class="search-form__row">
    <%= f.text_field :q, value: @q, placeholder: "Item名で検索", class: "input" %>
    <%= f.submit "絞り込む", class: "btn btn--ghost" %>
    <%= link_to "クリア", root_path(place_id: @current_place.id), class: "btn btn--ghost" %>
  </div>
<% end %>

<!-- Item一覧（クリック可能：右ペインにプレビュー） -->
<table class="items-table">
  <thead>
    <tr>
      <th>名前</th>
      <th class="col-small">数量</th>
    </tr>
  </thead>
  <tbody>
    <% @items.each do |item| %>
      <tr class="<%= 'is-selected' if @selected_item&.id == item.id %>">
        <td>
          <%= link_to item.name,
                      root_path(place_id: @current_place.id, item_id: item.id, q: (@q.presence)),
                      class: "item-link" %>
        </td>
        <td class="col-small"><%= item.quantity %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% content_for :right do %>
  <%= render "places/right_pane", current_place: @current_place, selected_item: @selected_item %>
<% end %>
